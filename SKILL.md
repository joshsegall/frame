# SKILL.md — Using Frame (`fr`) for Task Management

This file teaches coding agents how to use the `fr` CLI to manage tasks in a
Frame project. Frame is a markdown-based task tracker where `.md` files are the
source of truth. The CLI is the agent interface; humans use the TUI.

---

## Concepts

### Project Structure

Frame auto-discovers projects by walking up from the current directory looking
for a `frame/` directory (like git). Inside `frame/`:

- `project.toml` — config (tracks, ID prefixes, agent settings)
- `inbox.md` — unsorted capture area
- Track files (e.g., `tracks/effects.md`) — ordered backlogs
- `ACTIVE.md` — auto-generated summary (read-only, regenerated by `fr clean`)

To initialize a new project, run `fr init` in the target directory.

### Tracks

A track is a work stream with its own ordered backlog. Tracks have three states:

| State        | Meaning                  |
|--------------|--------------------------|
| **active**   | Current work stream      |
| **shelved**  | Paused, will return to   |
| **archived** | Finished, reference only |

One active track can be designated **cc-focus** — this is where the agent
looks for work first (`fr ready --cc`).

### Task States

| Checkbox | State     | Meaning                        |
|----------|-----------|--------------------------------|
| `[ ]`    | todo      | Not started                    |
| `[>]`    | active    | In progress                    |
| `[-]`    | blocked   | Waiting on a dependency        |
| `[x]`    | done      | Completed                      |
| `[~]`    | parked    | Deferred, not in active backlog|

### Task Metadata

Tasks can have:
- **ID** — track-prefixed identifier (e.g., `EFF-014`)
- **Tags** — freeform labels (`#ready`, `#cc`, `#bug`, etc.)
- **Dependencies** (`dep:`) — IDs of tasks that must complete first
- **Spec** (`spec:`) — path to the specification this task implements
- **Refs** (`ref:`) — paths to related files (design docs, tests, etc.)
- **Note** (`note:`) — freeform text, can be multiline with code blocks
- **Dates** — `added:` (auto-set on creation), `resolved:` (auto-set on done)

Subtasks are nested under their parent (up to 3 levels). Subtask IDs use
dotted notation: `EFF-014.1`, `EFF-014.2.1`.

### Tag Conventions

| Tag           | Meaning                                  |
|---------------|------------------------------------------|
| `#ready`      | Ready to execute (implementation clear)  |
| `#cc`         | Agent can take this and run with it      |
| `#cc-added`   | Filed by the agent                       |
| `#bug`        | Something broken                         |
| `#needs-input`| Needs human judgment to proceed          |
| `#research`   | Exploratory investigation                |
| `#design`     | Producing a design doc or spec           |

### Inbox

The inbox is an unsorted capture area for quick notes, bugs, and ideas that
haven't been triaged to a track yet. Inbox items have no IDs — they get one
when triaged.

### Priority

Position in the backlog *is* priority. The first task is highest priority.
There are no priority fields.

---

## Common Workflows

### Pick Up Work

```bash
# See what's available for you (cc-tagged tasks on the cc-focus track)
fr ready --cc

# Or see all unblocked tasks across active tracks
fr ready

# Filter by tag or track
fr ready --tag ready
fr ready --track effects

# Get details on a specific task
fr show EFF-014

# Check the dependency tree
fr deps EFF-014

# Mark it active
fr state EFF-014 active
```

### Report Progress

```bash
# Mark subtasks done as you complete them
fr state EFF-014.1 done

# Add a note with findings or context
fr note EFF-014 "Row unification needs special handling for polymorphic effects"

# Add a file reference to code you wrote or modified
fr ref EFF-014 src/effects/infer.rs

# Mark the parent task done when all subtasks are complete
fr state EFF-014 done
```

### File Findings

```bash
# Quick capture — use inbox when you're not sure which track it belongs to
fr inbox "Parser crashes on empty effect block" --tag bug

# File a task directly when you know the track
fr add effects "Handle empty effect blocks in parser" --found-from EFF-014

# Break a task into subtasks
fr sub EFF-014 "Add effect variables to closure types"
fr sub EFF-014 "Unify effect rows during inference"
fr sub EFF-014 "Test with nested closures"
```

### Structured Output

Append `--json` to any read command for machine-parseable output:

```bash
fr ready --cc --json
fr show EFF-014 --json
fr list --json
fr tracks --json
fr stats --json
fr check --json
```

---

## Command Reference

### Project Init

| Command | Description |
|---------|-------------|
| `fr init` | Initialize a new Frame project in the current directory |
| `fr init --name "name"` | Set project name (default: directory name) |
| `fr init --track <id> "name"` | Create an initial track (repeatable) |

### Reading

| Command | Description |
|---------|-------------|
| `fr ready` | Unblocked todo tasks across active tracks |
| `fr ready --cc` | cc-tagged tasks on cc-focus track |
| `fr ready --track <id>` | Unblocked tasks on a specific track |
| `fr ready --tag <tag>` | Unblocked tasks with a specific tag |
| `fr list [track]` | List tasks (all active tracks, or one track) |
| `fr list --state <state>` | Filter by state (todo/active/blocked/done/parked) |
| `fr list --tag <tag>` | Filter by tag |
| `fr list --all` | Include shelved and archived tracks |
| `fr show <id>` | Show full task details |
| `fr search <pattern>` | Regex search across tasks and inbox |
| `fr search <pattern> --track <id>` | Search within one track |
| `fr deps <id>` | Show dependency tree for a task |
| `fr blocked` | List blocked tasks and their blockers |
| `fr tracks` | List all tracks with stats |
| `fr stats` | Task count summary for active tracks |
| `fr recent` | Recently completed tasks |
| `fr recent --limit <n>` | Limit results (default: 20) |
| `fr inbox` | List inbox items |
| `fr check` | Validate project integrity (deps, refs, IDs) |

### Creating Tasks

| Command | Description |
|---------|-------------|
| `fr add <track> "title"` | Add task to bottom of track's backlog |
| `fr add <track> "title" --after <id>` | Insert after a specific task |
| `fr add <track> "title" --found-from <id>` | Add with "found while working on" note |
| `fr push <track> "title"` | Add task to top of track's backlog |
| `fr sub <id> "title"` | Add a subtask under a parent task |
| `fr inbox "text"` | Capture to inbox |
| `fr inbox "text" --tag bug` | Capture with tag |
| `fr inbox "text" --note "details"` | Capture with body text |

### Modifying Tasks

| Command | Description |
|---------|-------------|
| `fr state <id> <state>` | Change state (todo/active/blocked/done/parked). Setting a top-level Backlog task to `done` moves it to the Done section immediately. |
| `fr tag <id> add <tag>` | Add a tag |
| `fr tag <id> rm <tag>` | Remove a tag |
| `fr dep <id> add <dep-id>` | Add a dependency |
| `fr dep <id> rm <dep-id>` | Remove a dependency |
| `fr note <id> "text"` | Set task note |
| `fr ref <id> <filepath>` | Add a file reference |
| `fr spec <id> <path>` | Set spec reference (e.g., `doc/spec.md#section`) |
| `fr title <id> "new title"` | Change task title |
| `fr mv <id> --top` | Move task to top of backlog |
| `fr mv <id> --after <id>` | Move after another task |
| `fr mv <id> <position>` | Move to numeric position (0-indexed) |
| `fr mv <id> --track <track>` | Move to a different track (rewrites ID prefix, updates dep references) |

### Triage & Import

| Command | Description |
|---------|-------------|
| `fr triage <index> --track <id>` | Move inbox item to a track (1-based index) |
| `fr triage <index> --track <id> --top` | Triage to top of backlog |
| `fr triage <index> --track <id> --after <id>` | Triage after a specific task |
| `fr import <file.md> --track <id>` | Import tasks from a markdown file |
| `fr import <file.md> --track <id> --top` | Import at top of backlog |

### Track Management

| Command | Description |
|---------|-------------|
| `fr track new <id> "name"` | Create a new track |
| `fr track shelve <id>` | Shelve (pause) a track |
| `fr track activate <id>` | Activate a shelved track |
| `fr track archive <id>` | Archive a finished track |
| `fr track mv <id> <position>` | Reorder active tracks (0-indexed) |
| `fr track cc-focus <id>` | Set the cc-focus track |
| `fr track rename <id> --name "name"` | Rename a track's display name |
| `fr track rename <id> --new-id <new-id>` | Change a track's ID (moves file) |
| `fr track rename <id> --prefix <PREFIX> --yes` | Bulk-rewrite task ID prefixes |
| `fr track rename <id> --prefix <PREFIX> --dry-run` | Preview prefix rename |
| `fr track delete <id>` | Delete an empty track |

### Multi-Project

| Command | Description |
|---------|-------------|
| `fr projects` | List registered projects (sorted by last access) |
| `fr projects add <path>` | Register a project by path |
| `fr projects remove <name_or_path>` | Remove a project from the registry |
| `fr -C <path> <command>` | Run any command against a different project |

Projects are auto-registered when you run `fr init` or use `fr` in a project
directory. The registry lives at `~/.config/frame/projects.toml`.

### Maintenance

| Command | Description |
|---------|-------------|
| `fr clean` | Run maintenance (assign IDs/dates, archive done, validate) |
| `fr clean --dry-run` | Preview what clean would do |
| `fr check` | Read-only validation (deps, refs, duplicates) |

---

## Conventions

### When to use `#cc-added`

Tag tasks you create with `#cc-added` so the human knows an agent filed them.
This is configured as a default tag in `project.toml` under
`[ui] default_tags`.

### When to use `fr inbox` vs `fr add`

- **`fr inbox`** — Use when you're not sure which track something belongs to,
  or for quick notes that need human triage.
- **`fr add`** — Use when you know exactly which track the task belongs to.
- **`--found-from <id>`** — Use with `fr add` when you discover something
  while working on another task. Adds a note linking the discovery to context.

### How to structure subtasks

Use `fr sub` to break work into smaller pieces:

```bash
fr sub EFF-014 "Add effect variables to closure types"
fr sub EFF-014 "Unify effect rows during inference"
fr sub EFF-014 "Test with nested closures"
```

Subtasks get dotted IDs automatically (`EFF-014.1`, `EFF-014.2`, etc.).
Mark subtasks done individually as you complete them.

### Using `--json` for parsing

When you need to parse output programmatically, always use `--json`. Human
output formats are for display only and may change.

### Running maintenance

Run `fr clean` periodically. It:
- Assigns IDs to tasks missing them
- Adds `added:` dates where missing
- Archives done tasks past the threshold
- Flags dangling deps and broken file references
- Generates `ACTIVE.md` for orientation

Use `fr check` for read-only validation without making changes.

---

## Example Session

Here's a typical agent work session:

```bash
# 1. Check for available work
fr ready --cc
# Output: [infra] [ ] INFRA-015 Add span tracking to HIR nodes #ready #cc

# 2. Read the task details
fr show INFRA-015
# Shows: title, tags, deps, spec reference, subtasks

# 3. Pick it up
fr state INFRA-015 active

# 4. Break it into subtasks
fr sub INFRA-015 "Add Span field to HirNode struct"
fr sub INFRA-015 "Thread spans through lowering pass"
fr sub INFRA-015 "Update error reporting to use spans"

# 5. Work through subtasks, marking each done
fr state INFRA-015.1 done
fr ref INFRA-015 src/hir/mod.rs

fr state INFRA-015.2 done
fr note INFRA-015 "Lowering pass now preserves source spans from AST"

# 6. Discover a bug while working
fr inbox "Span merging loses column info for multi-line expressions" --tag bug
# Or if you know it belongs on this track:
fr add infra "Fix span merging for multi-line expressions" --found-from INFRA-015

# 7. Finish remaining subtask and close the task
fr state INFRA-015.3 done
fr state INFRA-015 done

# 8. Run maintenance
fr clean
```
