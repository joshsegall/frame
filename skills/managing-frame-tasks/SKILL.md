---
name: managing-frame-tasks
description: >
  Manages tasks using the frame (`fr`) CLI, a markdown-based task tracker
  where `.md` files in a `frame/` directory are the source of truth. Use when
  the project contains a `frame/` directory, or when asked to create, modify,
  triage, query, or prioritize tasks, tracks, inbox items, or backlog order.
  Also use when asked to check what work is available, report progress, or
  file bugs and findings.
---

# Frame CLI for Agents

The `fr` CLI is the agent interface to frame. Humans use the TUI.
Tasks are markdown files inside a `frame/` directory in the repo.

---

## Concepts

### Project structure

Frame auto-discovers projects by walking up from the current directory
looking for a `frame/` directory (like git). Inside `frame/`:

- `project.toml` — config (tracks, ID prefixes, agent settings)
- `inbox.md` — unsorted capture (no IDs until triaged)
- `tracks/<id>.md` — ordered backlogs (e.g., `tracks/effects.md`)
- `ACTIVE.md` — auto-generated summary (read-only, regenerated by `fr clean`)

Initialize with `fr init`.

### Tracks

Tracks are work streams. States: **active**, **shelved** (paused),
**archived** (finished). One active track can be **cc-focus** — the
agent checks here first via `fr ready --cc`.

### Task states

| Checkbox | State   | Meaning                         |
|----------|---------|---------------------------------|
| `[ ]`    | todo    | Not started                     |
| `[>]`    | active  | In progress                     |
| `[-]`    | blocked | Manually blocked (set by human) |
| `[x]`    | done    | Completed                       |
| `[~]`    | parked  | Deferred, not in active backlog |

### Metadata

- **ID** — track-prefixed (e.g., `EFF-014`). Subtasks use dots: `EFF-014.1`
- **Tags** — `#cc`, `#cc-added`, `#bug`, `#needs-input`, `#research`, `#design`
- **dep:** — IDs of blocking tasks
- **spec:** — path to spec this task implements
- **ref:** — paths to related files
- **note:** — freeform text (can include code blocks)
- **added:** / **resolved:** — dates (auto-set)

Subtasks nest up to 3 levels. Position in the backlog *is* priority —
there are no priority fields.

A task appears in `fr ready` output when it is `todo`, not `blocked`,
and has no unresolved dependencies. Blocked state and dependencies are
independent: `blocked` is set manually by the human, while `dep:` tracks
explicit task-to-task dependencies. Either one prevents a task from
being ready.

### Tag conventions

| Tag           | Meaning                                 |
|---------------|-----------------------------------------|
| `#cc`         | Agent can take this autonomously        |
| `#cc-added`   | Filed by the agent                      |
| `#bug`        | Something broken                        |
| `#needs-input`| Needs human judgment to proceed         |
| `#research`   | Exploratory investigation               |
| `#design`     | Producing a design doc or spec          |

---

## Workflows

### Pick up work

```bash
# Check for agent-tagged tasks on the cc-focus track
fr ready --cc

# Or see all unblocked tasks across active tracks
fr ready

# Filter by track
fr ready --track effects

# Read task details and deps before starting
fr show EFF-014
fr deps EFF-014

# Claim it
fr state EFF-014 active
```

### Report progress

```bash
fr state EFF-014.1 done
fr note EFF-014 "Row unification needs special handling for polymorphic effects"
fr ref EFF-014 src/effects/infer.rs
fr state EFF-014 done
```

### File findings

```bash
# Don't know which track → inbox
fr inbox "Parser crashes on empty effect block" --tag bug

# Know the track → add directly
fr add effects "Handle empty effect blocks in parser" --found-from EFF-014

# Break work into subtasks
fr sub EFF-014 "Add effect variables to closure types"
fr sub EFF-014 "Unify effect rows during inference"
fr sub EFF-014 "Test with nested closures"
```

### When stuck

- **`fr ready --cc` returns nothing** → Run `fr ready` (all tracks). If
  still nothing, check `fr blocked` for tasks you can unblock, or ask the
  human for direction.
- **Task is blocked** → Check `fr deps <id>` to see what's blocking it.
  If the blocker is something you can do, pick that up first. If it needs
  human input, tag the blocker `#needs-input` and move on.
- **Unsure which track** → Use `fr inbox` and let the human triage it.
- **Task is too large** → Break it down with `fr sub` before starting.
- **Conflicting or unclear spec** → Add a note with `fr note` explaining
  the ambiguity, tag `#needs-input`, and pick up different work.

---

## Command Reference

### Project init

| Command | Description |
|---------|-------------|
| `fr init` | Initialize a new frame project in the current directory |
| `fr init --name "name"` | Set project name (default: directory name) |
| `fr init --track <id> "name"` | Create an initial track (repeatable) |

### Reading

| Command | Description |
|---------|-------------|
| `fr ready` | Unblocked todo tasks across active tracks |
| `fr ready --cc` | cc-tagged tasks on cc-focus track |
| `fr ready --track <id>` | Unblocked tasks on a specific track |
| `fr ready --tag <tag>` | Unblocked tasks with a specific tag |
| `fr list [track]` | List tasks (all active tracks, or one track) |
| `fr list --state <state>` | Filter by state (todo/active/blocked/done/parked) |
| `fr list --tag <tag>` | Filter by tag |
| `fr list --all` | Include shelved and archived tracks |
| `fr show <id>` | Full task details |
| `fr search <pattern>` | Regex search across tasks and inbox |
| `fr search <pattern> --track <id>` | Search within one track |
| `fr deps <id>` | Dependency tree for a task |
| `fr blocked` | Blocked tasks and their blockers |
| `fr tracks` | All tracks with stats |
| `fr stats` | Task count summary for active tracks |
| `fr stats --all` | Include shelved tracks in stats |
| `fr recent` | Recently completed tasks |
| `fr recent --limit <n>` | Limit results (default: 20) |
| `fr inbox` | List inbox items |
| `fr check` | Validate project integrity (deps, refs, IDs) |

### Creating tasks

| Command | Description |
|---------|-------------|
| `fr add <track> "title"` | Add task to bottom of track's backlog |
| `fr add <track> "title" --after <id>` | Insert after a specific task |
| `fr add <track> "title" --found-from <id>` | Add with discovery context note |
| `fr push <track> "title"` | Add task to top of track's backlog |
| `fr sub <id> "title"` | Add a subtask under a parent task |
| `fr inbox "text"` | Capture to inbox |
| `fr inbox "text" --tag bug` | Capture with tag |
| `fr inbox "text" --note "details"` | Capture with body text |

### Modifying tasks

| Command | Description |
|---------|-------------|
| `fr state <id> <state>` | Change state. Setting a backlog task to `done` moves it to Done immediately |
| `fr tag <id> add <tag>` | Add a tag |
| `fr tag <id> rm <tag>` | Remove a tag |
| `fr dep <id> add <dep-id>` | Add a dependency |
| `fr dep <id> rm <dep-id>` | Remove a dependency |
| `fr note <id> "text"` | Set task note |
| `fr ref <id> <filepath>` | Add a file reference |
| `fr spec <id> <path>` | Set spec reference (e.g., `doc/spec.md#section`) |
| `fr title <id> "new title"` | Change task title |
| `fr mv <id> --top` | Move task to top of backlog |
| `fr mv <id> --after <id>` | Move after another task |
| `fr mv <id> <position>` | Move to numeric position (0-indexed) |
| `fr mv <id> --track <track>` | Move to different track (rewrites ID prefix, updates deps) |
| `fr mv <id> --promote` | Promote subtask to top-level (re-keys IDs) |
| `fr mv <id> --parent <id>` | Reparent under another task (re-keys IDs) |

### Triage & import

| Command | Description |
|---------|-------------|
| `fr triage <index> --track <id>` | Move inbox item to a track (1-based index) |
| `fr triage <index> --track <id> --top` | Triage to top of backlog |
| `fr triage <index> --track <id> --after <id>` | Triage after a specific task |
| `fr import <file.md> --track <id>` | Import tasks from a markdown file |
| `fr import <file.md> --track <id> --top` | Import at top of backlog |

### Track management

| Command | Description |
|---------|-------------|
| `fr track new <id> "name"` | Create a new track |
| `fr track shelve <id>` | Shelve (pause) a track |
| `fr track activate <id>` | Activate a shelved track |
| `fr track archive <id>` | Archive a finished track |
| `fr track mv <id> <position>` | Reorder active tracks (0-indexed) |
| `fr track cc-focus <id>` | Set the cc-focus track |
| `fr track rename <id> --name "name"` | Rename display name |
| `fr track rename <id> --new-id <new-id>` | Change track ID (moves file) |
| `fr track rename <id> --prefix <PREFIX> --yes` | Bulk-rewrite task ID prefixes |
| `fr track rename <id> --prefix <PREFIX> --dry-run` | Preview prefix rename |
| `fr track delete <id>` | Delete an empty track |

### Multi-project

| Command | Description |
|---------|-------------|
| `fr projects` | List registered projects (sorted by last access) |
| `fr projects add <path>` | Register a project by path |
| `fr projects remove <name_or_path>` | Remove from registry |
| `fr -C <path> <command>` | Run command against a different project |

Projects auto-register on `fr init` or first use. Registry:
`~/.config/frame/projects.toml`.

### Maintenance

| Command | Description |
|---------|-------------|
| `fr clean` | Assign IDs/dates, archive done tasks, validate, generate `ACTIVE.md` |
| `fr clean --dry-run` | Preview what clean would do |
| `fr check` | Read-only validation (deps, refs, duplicates) |

---

## Conventions

### Structured output

Append `--json` to any read command for machine-parseable output.
Always use `--json` when parsing output programmatically — human
formats are for display only and may change.

### Agent-filed tasks

Always tag tasks you create with `#cc-added` so the human knows an agent
filed them. This is not automatic — you must include it explicitly.
Include the tag inline in the title (it gets parsed out automatically):

```bash
fr add effects "Handle empty effect blocks #cc-added" --found-from EFF-014
```

### `fr inbox` vs `fr add`

- **`fr inbox`** — unsure which track, or quick note needing human triage
- **`fr add <track>`** — you know the track
- **`--found-from <id>`** — discovered while working on another task

### Subtask structure

Use `fr sub` to break work down. Subtasks get dotted IDs automatically
(`EFF-014.1`, `EFF-014.2`). Mark each done individually.

### Maintenance

Run `fr clean` periodically and `fr check` for read-only validation.

---

## Example Session

```bash
# 1. Check for available work
fr ready --cc
# → [infra] [ ] INFRA-015 Add span tracking to HIR nodes #cc

# 2. Read details
fr show INFRA-015

# 3. Claim it
fr state INFRA-015 active

# 4. Break into subtasks
fr sub INFRA-015 "Add Span field to HirNode struct"
fr sub INFRA-015 "Thread spans through lowering pass"
fr sub INFRA-015 "Update error reporting to use spans"

# 5. Work through subtasks
fr state INFRA-015.1 done
fr ref INFRA-015 src/hir/mod.rs

fr state INFRA-015.2 done
fr note INFRA-015 "Lowering pass now preserves source spans from AST"

# 6. Discover a bug while working
fr inbox "Span merging loses column info for multi-line expressions" --tag bug

# 7. Finish and close
fr state INFRA-015.3 done
fr state INFRA-015 done

# 8. Maintenance
fr clean
```
